---
title: React Batching l√† g√¨?¬†
description: Batching trong React m√¥ t·∫£ chi ti·∫øt tri·ªÉn khai n·ªôi b·ªô c·ªßa React, gi√∫p nh√≥m nhi·ªÅu y√™u c·∫ßu c·∫≠p nh·∫≠t tr·∫°ng th√°i trong m·ªôt l·∫ßn c·∫≠p nh·∫≠t
tags: React
author: Tr·ªçng D∆∞∆°ng ƒê·ª©c
publishAt: 2023-08-15T04:30:10.000Z
createdAt: 2023-08-15T04:30:10.000Z
updatedAt: 2024-06-03T15:04:09.603Z
views: 169
slug: react-batching-la-gi
---

Batching trong React m√¥ t·∫£ chi ti·∫øt tri·ªÉn khai n·ªôi b·ªô c·ªßa React, gi√∫p nh√≥m nhi·ªÅu y√™u c·∫ßu c·∫≠p nh·∫≠t tr·∫°ng th√°i trong m·ªôt l·∫ßn c·∫≠p nh·∫≠t. Do ƒë√≥, n√≥ ch·ªâ k√≠ch ho·∫°t  m·ªôt l·∫ßn render trong ph·∫°m vi component ƒë√≥, gi√∫p c·∫£i thi·ªán kh√° l·ªõn hi·ªáu xu·∫•t cho c√°c ·ª©ng d·ª•ng React l·ªõn.

B√¢y gi·ªù, h√£y c√πng th·ª≠ t√¨m hi·ªÉu Batching trong React qua v√≠ d·ª• sau:

```tsx
import * as React from 'react';

const App = () => {
  const [counter, setCounter] = React.useState(42);
  const [clicked, setClicked] = React.useState(0);

  const handleCounter = (digit) => {
    setCounter(counter + digit);
    setClicked(clicked + 1);
  };

  console.log('component rendering');

  return (
    <div>
      <button type="button" onClick={() => handleCounter(1)}>
        Increase
      </button>
      <button type="button" onClick={() => handleCounter(-1)}>
        Decrease
      </button>

      <div>Counter: {counter}</div>
      <div>Clicked: {clicked}</div>
    </div>
  );
};

export default App;
```

Khi ·∫•n v√†o m·ªôt trong 2 n√∫t ‚Äúbutton‚Äù increase ho·∫∑c decrease, m·∫∑c d√π c√≥ hai c·∫≠p nh·∫≠t tr·∫°ng th√°i x·∫£y ra trong `event handler` th√¨ component App v·∫´n ch·ªâ re-render duy nh·∫•t 1 l·∫ßn. B·∫°n c√≥ th·ªÉ t·ª± x√°c th·ª±c n√≥ b·∫±ng c√°ch th·ª≠ th·ª±c thi ƒëo·∫°n code tr√™n.

Tr∆∞·ªõc React 18, ƒëi·ªÅu n√†y ƒë∆∞·ª£c ki·ªÉm so√°t t·ªët, kh√¥ng ph·∫£i t·∫•t c·∫£ c√°c c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë·ªÅu ƒë∆∞·ª£c th·ª±c hi·ªán h√†ng lo·∫°t (batched). Cho v√≠ d·ª•, c√°c states ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫•t ƒë·ªìng b·ªô (e.g. Promise) ho·∫∑c Web API (e.g. setTimeout) kh√¥ng ƒë∆∞·ª£c batch v√† do ƒë√≥ ƒë√£ k√≠ch ho·∫°t hai re-render (ƒë·ªëi v·ªõi hai l·∫ßn c·∫≠p nh·∫≠t state t∆∞∆°ng ·ª©ng) c·ªßa th√†nh ph·∫ßn.

```tsx
import * as React from 'react';

const App = () => {
  const [counter, setCounter] = React.useState(42);
  const [clicked, setClicked] = React.useState(0);

  const handleCounterIncrease = () => {
    setTimeout(() => {
      setCounter(counter + 1);
      setClicked(clicked + 1);
    }, 0);
  };

  const handleCounterDecrease = async () => {
    await Promise.resolve();

    setCounter(counter - 1);
    setClicked(clicked + 1);
  };

  console.log('component rendering');

  return (
    <div>
      <button type="button" onClick={handleCounterIncrease}>
        Increase
      </button>
      <button type="button" onClick={handleCounterDecrease}>
        Decrease
      </button>

      <div>Counter: {counter}</div>
      <div>Clicked: {clicked}</div>
    </div>
  );
};

export default App;
```

V·ªõi b·ªï sung trong React 18, [Automatic batching](https://react.dev/blog/2022/03/29/react-v18#new-feature-automatic-batching) ƒë√£ ƒë∆∞·ª£c h·ªó tr·ª£. Tuy nhi√™n, n·∫øu c√≥ nh·ªØng t√¨nh hu·ªëng m√† b·∫°n mu·ªën c√°c state ƒë∆∞·ª£c c·∫≠p nh·∫≠t kh√¥ng theo c∆° ch·∫ø batching c·ªßa React, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `flushSync` ƒë·ªÉ t·ª´ ch·ªëi vi·ªác ƒë√≥.

```tsx
import * as React from 'react';
import { flushSync } from 'react-dom';

const App = () => {
  const [counter, setCounter] = React.useState(42);
  const [clicked, setClicked] = React.useState(0);

  const handleCounter = (digit) => {
    flushSync(() => {
      setCounter(counter + digit);
    });
    setClicked(clicked + 1);
  };

  console.log('component rendering');

  return (
    <div>
      <button type="button" onClick={() => handleCounter(1)}>
        Increase
      </button>
      <button type="button" onClick={() => handleCounter(-1)}>
        Decrease
      </button>

      <div>Counter: {counter}</div>
      <div>Clicked: {clicked}</div>
    </div>
  );
};

export default App;
```

`flushSync()` s·∫Ω bu·ªôc React √°p d·ª•ng ƒë·ªìng b·ªô c√°c c·∫≠p nh·∫≠t c√°c state. Do ƒë√≥, bu·ªôc React ph·∫£i c·∫≠p nh·∫≠t DOM ngay l·∫≠p t·ª©c. C√°c b·∫£n c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒëang ch·ªù x·ª≠ l√Ω kh√°c c≈©ng s·∫Ω b·ªã √°p d·ª•ng. Sau t·∫•t c·∫£, `flushSync` n√™n ƒë∆∞·ª£c s·ª≠ d·ª•ng m·ªôt c√°ch h·ª£p l√≠ (h·∫ßu nh∆∞ kh√¥ng bao gi·ªù d√πng =))))), ngo·∫°i tr·ª´ nh·ªØng tr∆∞·ªùng h·ª£p th·ª±c s·ª± c·∫ßn thi·∫øt, b·ªüi v√¨ n√≥ ƒëi k√®m v·ªõi nh·ªØng m·ªát m·ªèi m√† React ƒë√£ b·ªè c√¥ng c·∫£i thi·ªán n√≥. üòé

## K·∫øt lu·∫≠n

T√≥m l·∫°i, Batching trong React ch·ªâ l√† m·ªôt tri·ªÉn khai ƒë·ªÉ c·∫£i thi·ªán hi·ªáu su·∫•t c·ªßa c√°c b·∫£n c·∫≠p nh·∫≠t tr·∫°ng th√°i.
      